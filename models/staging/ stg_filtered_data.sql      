with cleaned_data as (
    select *
    from {{ ref('standardized_data') }}
    where vin is not null
      and make is not null
      and model is not null
)
select * from cleaned_data

with aggregated_data AS (
    select
        county,
        city,
        legislative_district,
        count(vin) as total_vehicles,
        count(distinct make) as unique_makes,
        count(distinct model) as unique_models,
        avg(electric_range) as avg_electric_range
    from cleaned_data
    group by county, city, legislative_district
)
select * from aggregated_data;